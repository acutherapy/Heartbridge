<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HeartBridge · Chat</title>
<meta name="theme-color" content="#0f1220">
<style>
:root{--bg:#0f1220;--card:#171a2f;--ink:#e8ebff;--muted:#9aa3c7;--brand:#7c5cff;--brand2:#2ee6a6}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:
  radial-gradient(900px 600px at 5% -10%, rgba(124,92,255,.25), transparent 60%),
  radial-gradient(900px 600px at 95% 110%, rgba(46,230,166,.15), transparent 60%),
  var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Roboto}
.nav{position:sticky;top:0;display:flex;justify-content:space-between;align-items:center;padding:14px 20px;background:rgba(10,12,25,.7);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.06)}
.logo{display:flex;gap:10px;align-items:center;font-weight:800}.logo i{width:10px;height:10px;border-radius:999px;background:linear-gradient(45deg,var(--brand),var(--brand2))}
.container{max-width:1100px;margin:0 auto;padding:16px;display:grid;gap:16px;grid-template-columns:1.2fr 1fr}
@media(max-width:900px){.container{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px}
.h1{font-size:clamp(26px,5vw,40px);margin:0 0 8px}
.sub{color:var(--muted)}
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.kpi{padding:12px;border-radius:12px;background:rgba(255,255,255,.03);border:1px dashed rgba(255,255,255,.12);text-align:center}
.kpi .big{font-size:22px;font-weight:800}
.chat{display:grid;grid-template-rows:auto 1fr auto;min-height:420px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.pill{border-radius:999px;padding:4px 8px;font-size:.8rem;background:rgba(255,255,255,.08);color:#c7cff1}
.messages{display:flex;flex-direction:column;gap:8px;overflow:auto;padding:8px}
.bubble{max-width:80%;padding:10px 12px;border-radius:12px;line-height:1.35}
.user{align-self:flex-end;background:rgba(124,92,255,.25);border:1px solid rgba(124,92,255,.35)}
.ai{align-self:flex-start;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12)}
.composer{display:flex;gap:8px}
.field{flex:1;display:flex;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:6px}
.field input{flex:1;background:transparent;border:0;outline:none;color:var(--ink);padding:8px}
.btn{border:0;border-radius:10px;padding:10px 12px;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
#loading{position:fixed;inset:0;display:grid;place-items:center;background:#0f1220;z-index:9999}
.spinner{width:44px;height:44px;border-radius:50%;border:4px solid #283048;border-top-color:#7c5cff;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style></head><body>
<div id="loading"><div class="spinner"></div></div>
<nav class="nav"><div class="logo"><i></i> HeartBridge</div><div id="userSlot" class="pill">Loading…</div></nav>
<section class="container">
  <div class="card">
    <h2 class="h1">Talk natural, connect real.</h2>
    <p class="sub">Pick your vibe and start chatting. AI keeps tone respectful and 18+ safe.</p>
    <div class="kpis"><div class="kpi"><div class="big" id="k1">142</div><div class="muted">Respect‑checked</div></div><div class="kpi"><div class="big" id="k2">580</div><div class="muted">Starters</div></div><div class="kpi"><div class="big" id="k3">36</div><div class="muted">Interests</div></div></div>
  </div>
  <div class="card chat">
    <div class="row"><span class="pill">AI Talk Assistant</span></div>
    <div id="msgs" class="messages" aria-live="polite"></div>
    <div class="composer">
      <div class="field"><input id="input" placeholder="Type your message… (Enter to send)"></div>
      <button id="send" class="btn">Send</button>
    </div>
  </div>
</section>
<script>
function hideLoader(){document.getElementById('loading')?.remove();}
if('serviceWorker'in navigator){
  navigator.serviceWorker.register('/service-worker.js').finally(()=>{
    navigator.serviceWorker.ready.then(hideLoader).catch(hideLoader);
    setTimeout(hideLoader, 2000);
  });
}else{hideLoader();}

const u = JSON.parse(localStorage.getItem('hb_user')||'null');
document.getElementById('userSlot').textContent = u?.email || 'Guest';

const msgs = document.getElementById('msgs');
function push(text, who='ai'){ const b=document.createElement('div'); b.className='bubble '+(who==='me'?'user':'ai'); b.textContent=text; msgs.appendChild(b); msgs.scrollTop=msgs.scrollHeight; }
push("Hey! I’m HeartBridge’s AI talk coach. Type something and I’ll suggest a kind, age‑appropriate next line.");
push("Reminder: Everyone here is 18+. Consent and kindness are non‑negotiable.");

async function askGPT(userText){
  const system = "You are HeartBridge’s tone‑safe opener coach for adults 18+. Keep replies short, kind, and non‑explicit.";
  const res = await fetch('/api/chat', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ messages:[ {role:'system',content:system}, {role:'user',content:userText} ] })
  });
  const data = await res.json();
  if(!res.ok) throw new Error(data.error||'API error');
  return data.text;
}

let sending=false;
async function doSend(){
  if(sending) return;
  const inp=document.getElementById('input'); const v=(inp.value||'').trim(); if(!v) return;
  sending=true; push(v,'me'); inp.value='';
  const typing=document.createElement('div'); typing.className='bubble ai'; typing.textContent='…'; msgs.appendChild(typing); msgs.scrollTop=msgs.scrollHeight;
  try{ const text=await askGPT(v); typing.remove(); push(text,'ai'); }
  catch(e){ typing.remove(); push("Network is busy; try again in a few secs.",'ai'); }
  finally{ sending=false; }
}
document.getElementById('send').addEventListener('click', e=>{e.preventDefault(); doSend();});
document.getElementById('input').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); doSend(); } });
</script>
</body></html>